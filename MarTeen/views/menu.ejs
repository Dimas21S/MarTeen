<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MarTeen App</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"rel="stylesheet"/>
    <style>
      body {
          margin: 0;
          font-family: Arial, sans-serif;
      }

      .container-fluid {
          display: flex;
      }

      .sidebar {
          width: 250px;
          background-color: #fff;
          height: 100vh;
          padding: 20px;
          border-right: 1px solid #e0e0e0;
      }

      .sidebar h2 {
          font-weight: bold;
      }

      .sidebar ul {
          list-style-type: none;
          padding: 0;
          margin-top: 30px;
      }

      .sidebar ul li {
          padding: 10px;
          margin: 10px 0;
          display: flex;
          align-items: center;
          transition: background-color 0.3s;
          border-radius: 20px;
      }

      .sidebar ul li:hover {
          background-color: orange;
          border-radius: 20px;
      }

      .sidebar ul li.active {
            background-color: orange;
            border-radius: 20px;
      }

      .sidebar ul li a {
          text-decoration: none;
          color: gray;
          display: flex;
          align-items: center;
          width: 100%;
      }

      .sidebar ul li i {
          margin-right: 10px;
      }

      .main-content {
          flex-grow: 1;
          padding: 20px;
          background-color: #f8f9fa;
          position: relative;
      }

      .promo-banner {
          background-color: #ffcc00;
          padding: 20px;
          border-radius: 10px;
          display: flex;
          justify-content: space-between;
          align-items: center;
      }

      .promo-banner img {
          width: 400px;
          height: auto;
          border-radius: 10px;
      }

      .categories {
          margin-top: 20px;
      }

      .category-card {
          text-align: center;
          padding: 10px;
          background-color: white;
          border-radius: 10px;
          box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      }

      .category-card:hover {
          transform: scale(1.05);
          box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
      }

      .category-card img {
          width: 70px;
          height: 70px;
          object-fit: cover;
      }

      .category-card h4 {
          margin-top: 10px;
          font-size: 16px;
      }

      .category-title {
          margin-top: 30px;
          font-weight: bold;
          font-size: 24px;
      }

      .view-all {
          text-align: right;
          margin-bottom: 10px;
      }

      .btn-login-register {
          position: absolute;
          top: 20px;
          right: 20px;
      }

      .search-bar input {
          width: 300px;
          padding: 10px;
          border: 1px solid #ddd;
          border-radius: 5px;
      }

      .canteen h3 {
          display: flex;
          justify-content: space-between;
          align-items: center;
          font-size: 20px;
          margin: 20px 0;
      }

      .canteen-name {
          color: #ff5722;
          font-weight: bold;
      }

      .view-all {
          color: #4caf50;
          text-decoration: none;
          font-size: 14px;
      }

      .menu-items {
          display: flex;
          justify-content: flex-start;
          gap: 10px;
      }

      .item {
          background: #fff;
          border: 1px solid #ddd;
          border-radius: 10px;
          text-align: center;
          padding: 10px;
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: space-between;
          box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
          transition: transform 0.3s;
      }

      .item img {
          max-width: 100px;
          border-radius: 10px;
          object-fit: cover;
      }

      .item button {
          background-color: #f8b400;
          border: none;
          color: white;
          padding: 10px;
          border-radius: 5px;
          cursor: pointer;
      }

      .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      background-color: orange;
      color: white;
      padding: 15px;
      border-radius: 5px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      display: none;
      z-index: 9999;
      font-family: Arial, sans-serif;
      font-size: 16px;
    }

    .notification.show {
      display: block;
      animation: slideIn 0.5s ease-out;
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateX(20px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }
  </style>
  </head>

  <body>
    <div class="container-fluid">
      <!-- Sidebar -->
      <div class="sidebar">
        <h2>
          <a href="/" style="text-decoration: none; color: inherit">MarTeen</a>
        </h2>
        <ul>
          <li>
            <a href="#">
              <img
                src="aset_index/Bill.png"
                alt="Bill Logo"
                style="width: 40px; height: auto; margin-right: 10px"
              />
              Diskon
            </a>
          </li>
          <li class="<%= (currentUrl === '/best-seller') ? 'active' : '' %>">
            <a href="/best-seller">
              <img
                src="aset_index/Review.png"
                alt="Best Seller"
                style="width: 40px; height: auto; margin-right: 10px"
              />
              Best Seller Kantin
            </a>
          </li>
          <li class="<%= (currentUrl === '/menu') ? 'active' : '' %>">
            <a href="/menu">
              <img
                src="aset_index/Bill.png"
                alt="Menu"
                style="width: 40px; height: auto; margin-right: 10px"
              />
              Menu
            </a>
          </li>
          <li class="<%= (currentUrl === '/pesanan') ? 'active' : '' %>">
            <a href="/pesanan">
              <img
                src="aset_index/Delivery Scooter.png"
                alt="Pesanan Makanan"
                style="width: 40px; height: auto; margin-right: 10px"
              />
              Pesanan Makanan
            </a>
          </li>
          <li
            class="<%= (currentUrl === '/profil-pengaturan') ? 'active' : '' %>"
          >
            <a href="/profil-pengaturan">
              <img
                src="aset_index/Process.png"
                alt="Profil & Pengaturan"
                style="width: 30px; margin-right: 10px"
              />
              Profil & Pengaturan
            </a>
          </li>
        </ul>
      </div>

      <!-- Main Content -->
      <div class="main-content">
        <div class="btn-login-register">
          <% if (user.name === 'Guest' || user.name === 'Stranger') { %>
              <button onclick="window.location.href='/login'" style="background-color: #ffcc00;">Login</button>
              <button onclick="window.location.href='/register'" style="background-color: #ffcc00;">Register</button>
          <% } else { %>
              <button onclick="window.location.href='/logout'" style="background-color: #ffcc00;">Logout</button>
          <% } %>
      </div>

        <h1>
          Hello, <% if (user) { %> <%= user.name %> <% } else { %> Stranger <% }
          %>
        </h1>

        <div id="notification" class="notification">
          Item berhasil ditambahkan
        </div>

        <% for (let kantin in menuGrouped) { %>
        <section class="canteen mb-5">
          <h3 class="d-flex justify-content-between align-items-center">
            <span class="canteen-name"><%= kantin %></span>
            <a href="#" class="view-all">View all</a>
          </h3>
          <div class="menu-items row">
            <% menuGrouped[kantin].forEach(item => { %>
            <div class="col-lg-2 col-md-2 col-sm-2 mb-3">
              <form
                action="/menu"
                method="post"
                class="item p-3 border rounded text-center"
              >
                <img
                  src="<%= item.gambar %>"
                  alt="<%= item.nama_menu %>"
                  class="img-fluid mb-3"
                  style="max-height: 100px"
                />
                <p><strong><%= item.nama_menu %></strong></p>
                <p><%= formatRupiah(item.harga) %></p>
                <!-- <% if (item.deskripsi) { %>
                <p><%= item.deskripsi %></p>
                <% } %> -->
                <!-- Hidden input untuk itemId -->
                <input type="hidden" name="id" value="<%= item.itemId %>" />
                <button onclick="submitMenuItem('<%= item.itemId %>', '<%= user.id %>')" type="button" class="btn btn-warning">+</button>
              </form>
            </div>
            <% }); %>
          </div>
        </section>
        <% } %>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      function submitMenuItem(itemId, userId) {
        event.preventDefault(); // Mencegah form default behavior
    
        // Mengirimkan data menggunakan fetch
        fetch('/menu', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/x-www-form-urlencoded'
          },
          body: `id=${encodeURIComponent(itemId)}&IdUser=${encodeURIComponent(userId)}`
        })
        .then(response => {
          if (response.ok) {
            // Menampilkan notifikasi
            const notificationElement = document.getElementById("notification");
            notificationElement.classList.add("show");
    
            // Sembunyikan notifikasi setelah 3 detik
            setTimeout(() => {
              notificationElement.classList.remove("show");
            }, 3000);
          } else {
            alert("Gagal menambahkan item ke keranjang.");
          }
        })
        .catch(error => {
          console.error('Error:', error);
        });
      }
    </script>
    
  </body>
</html>
